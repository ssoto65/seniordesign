/*
 * bam_SAM.c
 *
 * Created: 3/16/2019 11:41:38 AM
 *  Author: SamanthaSoto
 */ 

#include "sam.h"
#include "bam_SAM.h"
#include "led_SAM.h"
#include "i2c_SAM.h"

//#define BAM 0
//extern volatile uint8_t game;

uint8_t xPos;
uint8_t yPos;
extern volatile int16_t accel_x;
extern volatile int16_t accel_y;
extern volatile int16_t accel_z;

//Changed to fit orientation of main board
#define accel_up 8
#define accel_down 9
#define accel_right 10
#define accel_left 11

extern volatile uint8_t accel_dir;
extern volatile uint32_t wireless_mode;

extern uint8_t musicFlags[10];
#define bam_ball_move 0

#define lose 0
#define win 1
volatile uint8_t bam_WinOrLose;

volatile uint8_t bam_level = 0;

int bam_level_two[32][32] = {{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
{1,0,0,1,0,0,0,0,0,0,0,0,1,0,2,0,0,2,0,0,0,0,2,0,0,3,0,0,0,2,0,1},
{1,0,0,1,0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,0,0,0,2,0,3,3,3,0,2,2,2,1},
{1,0,0,1,0,0,2,2,2,2,0,0,1,0,2,0,0,2,0,0,0,0,2,0,0,3,0,0,0,2,0,1},
{1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1},
{1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1},
{1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,1},
{1,0,0,1,0,2,0,0,0,1,0,0,0,0,2,0,0,2,0,0,0,0,2,0,0,0,0,0,0,0,0,1},
{1,0,0,1,2,2,2,0,0,1,1,1,1,2,2,2,2,2,2,1,0,0,2,0,0,0,0,0,0,2,0,1},
{1,0,0,1,0,2,0,0,0,0,0,0,0,0,2,0,0,2,0,1,0,0,2,0,0,1,1,1,2,2,2,1},
{1,0,0,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,0,2,0,1},
{1,0,0,1,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,1},
{1,0,0,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,1},
{1,0,0,1,1,1,1,1,1,1,2,2,2,2,2,2,0,0,0,1,0,0,2,1,1,1,1,1,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,1},
{1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,2,0,0,0,1,0,0,2,0,0,0,2,0,0,2,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,1,0,0,2,0,0,2,2,2,2,2,2,1},
{1,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,1,0,0,2,0,0,0,2,0,0,2,0,1},
{1,0,2,2,2,0,0,0,1,1,1,1,1,1,1,1,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,1},
{1,0,0,2,0,0,0,0,1,0,2,0,0,0,0,1,0,0,0,2,0,0,2,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,1,2,2,2,0,0,0,1,0,0,0,2,0,0,2,2,2,2,2,2,2,0,0,1},
{1,0,0,0,0,2,0,0,1,0,2,0,0,0,0,1,0,0,0,2,0,0,2,0,0,0,0,0,2,0,0,1},
{1,0,0,0,2,2,2,0,1,0,0,0,0,0,0,1,0,0,0,2,0,0,2,0,0,0,0,0,2,0,0,1},
{1,0,0,0,0,2,0,0,1,0,0,0,0,0,0,1,0,0,0,2,0,0,2,0,0,2,0,0,2,0,0,1},
{1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,1,0,0,0,2,0,0,2,0,0,2,0,0,2,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,2,0,0,0,0,0,2,0,0,2,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,2,0,0,2,0,0,1},
{1,0,2,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,1,0,2,0,0,0,2,0,0,2,0,0,1},
{1,2,2,2,1,1,1,1,1,2,2,2,0,0,0,0,0,0,0,1,2,2,2,0,0,2,0,0,0,0,0,1},
{1,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1,0,2,0,0,0,2,0,0,0,0,0,1},
{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}};
	
int bam_level_one_OG[32][32] = {{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
{1,0,0,1,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1},
{1,0,0,1,2,2,2,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,1},
{1,0,0,1,0,2,0,0,0,0,0,0,0,2,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,2,0,1},
{1,0,0,1,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,0,0,0,0,1},
{1,0,0,1,0,0,1,0,0,1,0,2,0,0,0,0,0,0,0,0,0,1,2,2,2,0,0,0,0,0,0,1},
{1,0,0,1,0,0,1,0,0,1,2,2,2,0,0,0,0,0,0,0,0,1,0,2,0,0,0,0,0,0,0,1},
{1,0,0,1,0,0,1,0,0,1,0,2,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1},
{1,0,0,1,0,0,1,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,1},
{1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,2,2,2,1,0,0,1,1,1},
{1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,1},
{1,0,0,1,0,0,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1},
{1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,1},
{1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,1,0,0,1,1,1},
{1,1,1,1,1,1,1,1,0,0,0,0,0,2,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1},
{1,0,2,0,0,0,0,0,0,0,0,0,2,2,2,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1},
{1,2,2,2,0,0,0,0,0,0,0,0,0,2,0,1,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1},
{1,0,2,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,2,0,0,0,0,1},
{1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,2,2,2,0,0,0,1},
{1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,2,0,0,0,0,1},
{1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,1},
{1,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1},
{1,0,0,0,0,0,2,2,2,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,3,0,1},
{1,0,0,0,0,0,0,2,0,0,0,0,1,0,0,1,0,0,1,1,1,1,1,1,1,0,0,1,3,3,3,1},
{1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,3,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,1},
{1,0,2,0,1,1,1,1,1,0,2,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,2,0,1},
{1,2,2,2,0,0,0,0,0,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,1},
{1,0,2,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1},
{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}};
	
int bam_level_one[32][32];

void bam_play(void){
	//game = BAM;
	bam_screen_load();
	bam_init_ball();
	
	bam_WinOrLose = 37;
	
	//start our TC0
	REG_TC0_CCR0 &= ~TC_CCR_CLKDIS;
	REG_TC0_CCR0 |= TC_CCR_CLKEN;
	REG_TC0_CCR0 |= TC_CCR_SWTRG;
}

void bam_screen_load(void){
	
	clear_matrix();
	//for(int i=0; i < 50; i++){
		for(int ii = 0; ii < 32; ii++){
			//ii = 0;
			for(int jj = 0; jj < 32; jj++){
				if(bam_level == 0){
					bam_level_one[ii][jj] = bam_level_one_OG[ii][jj];
				}else{
					bam_level_one[ii][jj] = bam_level_two[ii][jj];
				}
				
				if(bam_level_one[ii][jj]== 1){
					set_LED(ii,jj,0xFF0000);
				}
				else if(bam_level_one[ii][jj]== 2){
					set_LED(ii,jj,0x0000FF);
				}
				else if(bam_level_one[ii][jj]== 3){
					set_LED(ii,jj,0x00FF00);
				}
				else{
					set_LED(ii,jj,0);
				}
			}
		}
	//}
}

void bam_init_ball(void){
	//Initialize ball
	xPos = 1;
	yPos = 1;
	set_LED(xPos,yPos,0x00FFFFFF);
}

void mazerefresh(void){
	
	accel_data();
	//RIGHT
	if( (((accel_x > -750) && (accel_x < 750) && (accel_y < -1600)) && (wireless_mode == 0)) || ((accel_dir == accel_right) && ((wireless_mode) == 1)) ){
		if((bam_level_one[xPos][yPos-1] == 0) ){
			musicFlags[bam_ball_move] = 1;
			set_LED(xPos,yPos,0x00);
			set_LED(xPos,--yPos,0x00FFFFFF);
		}
			//Red
		else if((bam_level_one[xPos][yPos-1] == 2) ){
			bam_WinOrLose = lose;
			bam_level = 0;
		}
		//Green
		else if((bam_level_one[xPos][yPos-1] == 3) ){
			bam_level++;
			if(bam_level == 2){
				bam_WinOrLose = win;
			}
			else{
				bam_play();
			}
		}
	}
	//LEFT
	else if( (((accel_x > -850) && (accel_x < 850) && (accel_y > 500)) && (wireless_mode == 0)) || ((accel_dir == accel_left) && ((wireless_mode) == 1))){
		if((bam_level_one[xPos][1+yPos] == 0) ){
			musicFlags[bam_ball_move] = 1;
			set_LED(xPos,yPos,0x00);
			set_LED(xPos,++yPos,0x00FFFFFF);
		}
		else if((bam_level_one[xPos][1+yPos] == 2)){
		bam_WinOrLose = lose;
		bam_level = 0;
		}
		//Green
		else if((bam_level_one[xPos][1+yPos] == 3)){
			bam_level++;
			if(bam_level == 2){
				bam_WinOrLose = win;
			}
			else{
				bam_play();
			}
		}
	}
	//DOWN
	else if( (((accel_y > -850) && (accel_y < 850) && (accel_x < -700))  && (wireless_mode == 0)) || ((accel_dir == accel_down) && ((wireless_mode) == 1))){
		if((bam_level_one[1+xPos][yPos] == 0) ){
			musicFlags[bam_ball_move] = 1;
			set_LED(xPos,yPos,0x00);
			set_LED(++xPos,yPos,0x00FFFFFF);
		}
		else if((bam_level_one[1+xPos][yPos] == 2)){
			bam_WinOrLose = lose;
			bam_level = 0;
		}
		else if ((bam_level_one[1+xPos][yPos] == 3)){
			bam_level++;
			if(bam_level == 2){
				bam_WinOrLose = win;
			}
			else{
				bam_play();
			}
		}
	}
	//UP
	else if( (((accel_y > -850) && (accel_y < 850) && (accel_x > 650))  && (wireless_mode == 0)) || ((accel_dir == accel_up) && ((wireless_mode) == 1))){
		//Empty Space
		if((bam_level_one[xPos-1][yPos] == 0) ){
			musicFlags[bam_ball_move] = 1;
			set_LED(xPos,yPos,0x00);
			set_LED(--xPos,yPos,0x00FFFFFF);
		}//RED
		else if((bam_level_one[xPos-1][yPos] == 2)){
		bam_WinOrLose = lose;
		bam_level = 0;
		}
		else if ((bam_level_one[xPos-1][yPos] == 3)){
			bam_level++;
			if(bam_level == 2){
				bam_WinOrLose = win;
			}
			else{
				bam_play();
			}
		}
		}
}